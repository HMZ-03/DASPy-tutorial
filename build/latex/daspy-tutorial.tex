%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}
\setcounter{tocdepth}{2}


\usepackage{fontspec}
\usepackage{polyglossia}
\setmainlanguage{english}
\setmainfont{Times New Roman}


\title{DASPy\sphinxhyphen{}tutorial}
\date{Jul 26, 2025}
\release{1.0.0}
\author{Minzhe Hu}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
\sphinxincludegraphics[height=200\sphinxpxdimen]{{logo}.png}

\sphinxAtStartPar
DASPy is an open\sphinxhyphen{}source project that provides a python package for DAS (Distributed Acoustic Sensing) data processing.

\sphinxAtStartPar
The goal of the DASPy project is to lower the bar for DAS data processing and promote the development of DAS seismology.


\chapter{Contents}
\label{\detokenize{index:contents}}
\sphinxstepscope


\section{Installation}
\label{\detokenize{Installation:installation}}\label{\detokenize{Installation::doc}}
\sphinxAtStartPar
DASPy can be installed through common methods such as Pip and Conda.


\subsection{Install via Pip}
\label{\detokenize{Installation:install-via-pip}}
\sphinxAtStartPar
Install from PyPI:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pip} \PYG{n}{install} \PYG{n}{daspy}\PYG{o}{\PYGZhy{}}\PYG{n}{toolbox}
\end{sphinxVerbatim}

\sphinxAtStartPar
Install the latest version from GitHub:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pip} \PYG{n}{install} \PYG{n}{git}\PYG{o}{+}\PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{HMZ}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{03}\PYG{o}{/}\PYG{n}{DASPy}\PYG{o}{.}\PYG{n}{git}
\end{sphinxVerbatim}

\sphinxAtStartPar
If you installed DASPy this way, you can upgrade DASPy with the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pip} \PYG{n}{install} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{upgrade} \PYG{n}{git}\PYG{o}{+}\PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{HMZ}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{03}\PYG{o}{/}\PYG{n}{DASPy}\PYG{o}{.}\PYG{n}{git}
\end{sphinxVerbatim}


\subsection{Install via Conda}
\label{\detokenize{Installation:install-via-conda}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{conda} \PYG{n}{install} \PYG{n}{daspy}\PYG{o}{\PYGZhy{}}\PYG{n}{toolbox}
\end{sphinxVerbatim}

\sphinxAtStartPar
or

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{conda} \PYG{n}{install} \PYG{n}{conda}\PYG{o}{\PYGZhy{}}\PYG{n}{forge}\PYG{p}{:}\PYG{p}{:}\PYG{n}{daspy}\PYG{o}{\PYGZhy{}}\PYG{n}{toolbox}
\end{sphinxVerbatim}


\subsection{Manual Installation}
\label{\detokenize{Installation:manual-installation}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Clone or download the DASPy repository from \sphinxhref{https://github.com/HMZ-03/DASPy?tab=readme-ov-file}{Github};

\item {} 
\sphinxAtStartPar
Install the following dependency packages: numpy, scipy >=1.13, matplotlib, geographiclib, pyproj, h5py, segyio, nptdms;

\item {} 
\sphinxAtStartPar
Add the DASPy directory to your Python package path.

\end{enumerate}

\sphinxstepscope


\section{Reading DAS Data}
\label{\detokenize{Reading DAS Data:reading-das-data}}\label{\detokenize{Reading DAS Data::doc}}

\subsection{Reading Data from Files}
\label{\detokenize{Reading DAS Data:reading-data-from-files}}
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{read function}} is used to read multiple types of DAS data files. The supported data formats are shown in the following table:


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|T|}
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
format
&\sphinxstyletheadfamily 
\sphinxAtStartPar
read
&\sphinxstyletheadfamily 
\sphinxAtStartPar
write
&\sphinxstyletheadfamily 
\sphinxAtStartPar
source
\\
\hline
\sphinxAtStartPar
HDF5
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
OptaSense, Silixa, Febus, AP Sensing, ASN, Sintela, Aragón Photonics、T8 Sensors, Smart Earth Sensing, AI4EPS, INGV, JAMSTEC and FORESEE database
\\
\hline
\sphinxAtStartPar
TDMS
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
Silixa and the Institute of Semiconductors, CAS
\\
\hline
\sphinxAtStartPar
SEG\sphinxhyphen{}Y
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
OptaSens and Silixa
\\
\hline
\sphinxAtStartPar
PICKLE
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
daspy.Section or numpy.ndarray class instances saved in binary
\\
\hline
\sphinxAtStartPar
NPY
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
√
&
\sphinxAtStartPar
numpy.ndarray class instances saved in binary
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}

\sphinxAtStartPar
By default, the function will output a \sphinxcode{\sphinxupquote{Section}} class instance containing data and metadata:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} Read waveform example}
\end{sphinxVerbatim}

\sphinxAtStartPar
You can set \sphinxcode{\sphinxupquote{output\_type='array'}} to output data in \sphinxcode{\sphinxupquote{numpy.array}} format, in which case metadata will be output in \sphinxcode{\sphinxupquote{dict}} format. Setting \sphinxcode{\sphinxupquote{ch1}} or/and \sphinxcode{\sphinxupquote{ch2}} limits the range of channels to read.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data}\PYG{p}{,} \PYG{n}{metadata} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{n}{output\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{array}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ch1}\PYG{o}{=}\PYG{l+m+mi}{2700}\PYG{p}{,} \PYG{n}{ch2}\PYG{o}{=}\PYG{l+m+mi}{2800}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} set channel range}
\end{sphinxVerbatim}

\sphinxAtStartPar
When only metadata is needed, you can set \sphinxcode{\sphinxupquote{headonly=True}} to save reading time. In this case, the returned data will be an all\sphinxhyphen{}zero array of the same size as the original data.


\subsection{Customize a Read Function}
\label{\detokenize{Reading DAS Data:customize-a-read-function}}
\sphinxAtStartPar
If DASPy does not support reading your data, you can create a custom read function. Although the function can complete the reading with only the parameter \sphinxcode{\sphinxupquote{fname}} , we recommend that users allow the function to input parameters \sphinxcode{\sphinxupquote{headonly}}, \sphinxcode{\sphinxupquote{ch1}} and \sphinxcode{\sphinxupquote{ch2}} to ensure full compatibility:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{h5py}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{DASDateTime}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k}{def} \PYG{n+nf}{read\PYGZus{}new\PYGZus{}h5}\PYG{p}{(}\PYG{n}{fname}\PYG{p}{,} \PYG{n}{headonly}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{kwargs}\PYG{p}{)}\PYG{p}{:}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{k}{with} \PYG{n}{h5py}\PYG{o}{.}\PYG{n}{File}\PYG{p}{(}\PYG{n}{fname}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{h5\PYGZus{}file}\PYG{p}{:}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{start\PYGZus{}channel} \PYG{o}{=} \PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel\PYGZus{}start}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{end\PYGZus{}channel} \PYG{o}{=} \PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel\PYGZus{}end}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{ch1} \PYG{o}{=} \PYG{n}{kwargs}\PYG{o}{.}\PYG{n}{pop}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ch1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{start\PYGZus{}channel}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{ch2} \PYG{o}{=} \PYG{n}{kwargs}\PYG{o}{.}\PYG{n}{pop}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ch2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{end\PYGZus{}channel}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{dch} \PYG{o}{=} \PYG{n}{kwargs}\PYG{o}{.}\PYG{n}{pop}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dch}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{k}{if} \PYG{n}{headonly}\PYG{p}{:}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }            \PYG{n}{data} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{h5\PYGZus{}file}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{raw\PYGZus{}data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{k}{else}\PYG{p}{:}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }            \PYG{n}{data} \PYG{o}{=} \PYG{n}{h5\PYGZus{}file}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{raw\PYGZus{}data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ch1}\PYG{o}{\PYGZhy{}}\PYG{n}{start\PYGZus{}channel}\PYG{p}{:}\PYG{n}{ch2}\PYG{o}{\PYGZhy{}}\PYG{n}{start\PYGZus{}channel}\PYG{p}{:}\PYG{n}{dch}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{dx} \PYG{o}{=} \PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel spacing m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{metadata} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{dx}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sampling rate Hz}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gauge\PYGZus{}length}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GL m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{start\PYGZus{}channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{start\PYGZus{}channel} \PYG{o}{+} \PYG{n}{ch1}\PYG{p}{,}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{start\PYGZus{}distance}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{(}\PYG{n}{start\PYGZus{}channel} \PYG{o}{+} \PYG{n}{ch1}\PYG{p}{)} \PYG{o}{*} \PYG{n}{dx}\PYG{p}{,}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{start\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{DASDateTime}\PYG{o}{.}\PYG{n}{strptime}\PYG{p}{(}\PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{starttime}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{T}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{H:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{M:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{S.}\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{scale}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{h5\PYGZus{}file}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{scale factor to strain}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{k}{return} \PYG{n}{data}\PYG{p}{,} \PYG{n}{metadata}
\end{sphinxVerbatim}

\sphinxAtStartPar
The required keywords in \sphinxcode{\sphinxupquote{metadata}} are \sphinxcode{\sphinxupquote{dx}} and \sphinxcode{\sphinxupquote{fs}} (which can be temporarily set to \sphinxcode{\sphinxupquote{None}} if they are not included in the file metadata), and the remaining parameters can be read on demand. This read function can then be input as the \sphinxcode{\sphinxupquote{ftype}} parameter to the \sphinxcode{\sphinxupquote{read}} function or used to construct a \sphinxcode{\sphinxupquote{Collection}} class (See {\hyperref[\detokenize{Handling Continuous Data::doc}]{\sphinxcrossref{\DUrole{doc}{Processing continuous data}}}} for details).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{n}{fname}\PYG{p}{,} \PYG{n}{ftype}\PYG{o}{=}\PYG{n}{read\PYGZus{}new\PYGZus{}h5}\PYG{p}{,} \PYG{n}{headonly}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{coll} \PYG{o}{=} \PYG{n}{Collection}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../data/*.h5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ftype}\PYG{o}{=}\PYG{n}{read\PYGZus{}new\PYGZus{}h5}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Converting from Instances of Other Packages}
\label{\detokenize{Reading DAS Data:converting-from-instances-of-other-packages}}
\sphinxAtStartPar
It’s supported to streaming data from \sphinxhref{https://docs.obspy.org/}{ObsPy} , \sphinxhref{https://dascore.org/}{DASCore} and \sphinxhref{https://github.com/pyrocko/lightguide}{lightguide} to DASPy:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{Section}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}obspy} \PYG{o}{=} \PYG{n}{Section}\PYG{o}{.}\PYG{n}{from\PYGZus{}obspy\PYGZus{}stream}\PYG{p}{(}\PYG{n}{st}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} convert obspy.core.stream.Stream instance to daspy.section instance}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}dascore} \PYG{o}{=} \PYG{n}{Section}\PYG{o}{.}\PYG{n}{from\PYGZus{}dascore\PYGZus{}patch}\PYG{p}{(}\PYG{n}{patch}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} convert dascore.core.patch.Patch instance to daspy.section instance}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}lightguide} \PYG{o}{=} \PYG{n}{Section}\PYG{o}{.}\PYG{n}{from\PYGZus{}lightguide\PYGZus{}blast}\PYG{p}{(}\PYG{n}{blast}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} convert lightguide.blast.Blast instance to daspy.section instance}
\end{sphinxVerbatim}


\subsection{Section}
\label{\detokenize{Reading DAS Data:section}}
\sphinxAtStartPar
The functions of DASPy can be implemented by calling functions (process\sphinxhyphen{}oriented) or through class methods (object\sphinxhyphen{}oriented). We recommend an object\sphinxhyphen{}oriented approach to operate on the \sphinxcode{\sphinxupquote{Section}} class of the DAS data body. All user\sphinxhyphen{}facing functions and class methods in DASPy have the same name and are nouns (such as \sphinxcode{\sphinxupquote{normalization}} and \sphinxcode{\sphinxupquote{Section.normalization}}).

\sphinxAtStartPar
The attributes of the \sphinxcode{\sphinxupquote{Section}} class save the DAS data and header information, among which the waveform data \sphinxcode{\sphinxupquote{data}}, channel spacing \sphinxcode{\sphinxupquote{dx}}, and sampling rate \sphinxcode{\sphinxupquote{fs}} must be set (but can be temporarily Set to \sphinxcode{\sphinxupquote{None}} ); the starting channel number \sphinxcode{\sphinxupquote{start\_channel}}, the starting distance \sphinxcode{\sphinxupquote{start\_distance}}, and the starting time \sphinxcode{\sphinxupquote{start\_time}} default to 0 if not set; the event starting time \sphinxcode{\sphinxupquote{origin\_time}}, gauge length \sphinxcode{\sphinxupquote{gauge\_length}}, data type \sphinxcode{\sphinxupquote{data\_type}}, data scale \sphinxcode{\sphinxupquote{scale}}, array geometry \sphinxcode{\sphinxupquote{geometry}}, turning point channel number \sphinxcode{\sphinxupquote{turning\_channels}}, other header information \sphinxcode{\sphinxupquote{headers}} are not necessary.

\sphinxAtStartPar
Accessing meta data：

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{sec}\PYG{p}{)}
\PYG{g+go}{              data: shape(500, 5000)}
\PYG{g+go}{                dx: 1 m}
\PYG{g+go}{                fs: 100.0 Hz}
\PYG{g+go}{     start\PYGZus{}channel: 2500}
\PYG{g+go}{    start\PYGZus{}distance: 2520 m}
\PYG{g+go}{        start\PYGZus{}time: 2016\PYGZhy{}03\PYGZhy{}21 07:37:30.532309+00:00}
\PYG{g+go}{       origin\PYGZus{}time: 2016\PYGZhy{}03\PYGZhy{}21 07:37:10.535000+00:00}
\PYG{g+go}{         data\PYGZus{}type: strain rate}
\end{sphinxVerbatim}

\sphinxAtStartPar
In addition, the data size \sphinxcode{\sphinxupquote{shape}}, the number of channels \sphinxcode{\sphinxupquote{nch}}, the number of sampling points \sphinxcode{\sphinxupquote{nt}}, the end channel number \sphinxcode{\sphinxupquote{end\_channel}}, the end distance \sphinxcode{\sphinxupquote{end\_distance}} and the end time \sphinxcode{\sphinxupquote{end\_time}} will Automatically calculated and can be called as a property.


\subsection{DASDateTime}
\label{\detokenize{Reading DAS Data:dasdatetime}}
\sphinxAtStartPar
DASPy create the \sphinxcode{\sphinxupquote{DASDateTime}} class to represent the time information of the data, including the start time \sphinxcode{\sphinxupquote{start\_time}}, the end time \sphinxcode{\sphinxupquote{end\_time}} and the event start time \sphinxcode{\sphinxupquote{origin\_time}}.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{DASDateTime}} is a subclass of the \sphinxcode{\sphinxupquote{datetime.DateTime}} class and inherits all methods of \sphinxcode{\sphinxupquote{datetime.DateTime}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{core} \PYG{k+kn}{import} \PYG{n}{DASDateTime}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{o}{.}\PYG{n}{strptime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}03\PYGZhy{}19T1:52:23}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{T}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{H:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{M:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{S}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+go}{DASDateTime(2021, 03, 19, 1, 52, 23)}
\end{sphinxVerbatim}

\sphinxAtStartPar
DASPy has built\sphinxhyphen{}in local time zone \sphinxcode{\sphinxupquote{local\_tz}} and utc time zone \sphinxcode{\sphinxupquote{utc}} for specifying the time zone:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{core}\PYG{n+nn}{.}\PYG{n+nn}{dasdatetime} \PYG{k+kn}{import} \PYG{n}{utc}\PYG{p}{,} \PYG{n}{local\PYGZus{}tz}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{o}{.}\PYG{n}{fromtimestamp}\PYG{p}{(}\PYG{l+m+mi}{1616089943}\PYG{p}{,} \PYG{n}{tz}\PYG{o}{=}\PYG{n}{utc}\PYG{p}{)}
\PYG{g+go}{DASDateTime(2021, 3, 18, 17, 52, 23, tzinfo=datetime.timezone.utc)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Use \sphinxcode{\sphinxupquote{datetime.timezone(datetime.timedelta(hours=h))}} to create other time zones if needed.

\sphinxAtStartPar
You may use the \sphinxcode{\sphinxupquote{local}}, \sphinxcode{\sphinxupquote{utc}}, and \sphinxcode{\sphinxupquote{remove\_tz}} methods to convert or remove timezone information:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{time} \PYG{o}{=} \PYG{n}{DASDateTime}\PYG{o}{.}\PYG{n}{strptime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}03\PYGZhy{}19T1:52:23Z}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{T}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{H:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{M:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{S}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{z}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{time}\PYG{o}{.}\PYG{n}{local}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{DASDateTime(2021, 3, 19, 9, 52, 23, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800)))}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{time}\PYG{o}{.}\PYG{n}{remove\PYGZus{}tz}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{DASDateTime(2021, 3, 19, 1, 52, 23)}
\end{sphinxVerbatim}

\sphinxAtStartPar
In addition to the addition and subtraction operations between \sphinxcode{\sphinxupquote{datetime.datetime}} and \sphinxcode{\sphinxupquote{datetime.timedelta}} supported by the parent class itself, \sphinxcode{\sphinxupquote{DASDateTime}} also supports input numbers and iterable objects \sphinxcode{\sphinxupquote{Iterable}} to calculate additions and subtraction. All time differences are expressed in seconds (s), and problems with unspecified time zones are automatically handled:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2021}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{28}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mi}{100}
\PYG{g+go}{DASDateTime(2021, 3, 24, 14, 29, 40)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2021}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{28}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{+} \PYG{p}{[}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{]}
\PYG{g+go}{[DASDateTime(2021, 3, 24, 14, 28, 10), DASDateTime(2021, 3, 24, 14, 28, 20), DASDateTime(2021, 3, 24, 14, 28, 30)]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2021}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{28}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{100}
\PYG{g+go}{DASDateTime(2021, 3, 24, 14, 26, 20)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2021}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{28}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2021}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{19}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{52}\PYG{p}{,} \PYG{l+m+mi}{23}\PYG{p}{)}
\PYG{g+go}{477337.0}
\end{sphinxVerbatim}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{DASDateTime}} instances can be converted to parent class \sphinxcode{\sphinxupquote{datetime.datetime}} instances when necessary:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2021}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{19}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{52}\PYG{p}{,} \PYG{l+m+mi}{23}\PYG{p}{)}\PYG{o}{.}\PYG{n}{convert\PYGZus{}to\PYGZus{}datetime}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{datetime.datetime(2021, 3, 19, 1, 52, 23)}
\end{sphinxVerbatim}

\sphinxstepscope


\section{Processing continuous data}
\label{\detokenize{Handling Continuous Data:processing-continuous-data}}\label{\detokenize{Handling Continuous Data::doc}}
\sphinxAtStartPar
When processing continuous\sphinxhyphen{}time signals such as various types of filtering, downsampling, cosine taper, time differentiation or integration, processing each single file and then splicing then will cause data discontinuity. Using the \sphinxcode{\sphinxupquote{collection}} class to process continuous data can solve the continuity problem of these operations.


\subsection{Collection}
\label{\detokenize{Handling Continuous Data:collection}}
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{Collection}} class is used to store continuous data belonging to the same acquisition. It saves the list of continuous data file paths \sphinxcode{\sphinxupquote{flist}} and the start time of each file \sphinxcode{\sphinxupquote{ftime}}, as well as the metadata information of the acquisition, including the number of channels \sphinxcode{\sphinxupquote{nch}}, the track spacing \sphinxcode{\sphinxupquote{dx}}, the gauge length \sphinxcode{\sphinxupquote{gauge\_length}}, the sampling rate \sphinxcode{\sphinxupquote{fs}}, the number of sampling points of a single file \sphinxcode{\sphinxupquote{nt}} and the duration of a single file \sphinxcode{\sphinxupquote{flength}}. When initializing a class instance, by default, the metadata of the second data file is read to obtain all metadata information, and the start time of each file \sphinxcode{\sphinxupquote{ftime}} is automatically calculated based on the start time \sphinxcode{\sphinxupquote{start\_time}} of the second data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{Collection}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{coll} \PYG{o}{=} \PYG{n}{Collection}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{data/*.h5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{coll}
\PYG{g+go}{       flist: 2608 files}
\PYG{g+go}{              [data/TEST\PYGZus{}2000m\PYGZus{}4m\PYGZus{}1\PYGZus{}5000Hz\PYGZus{}200Hz\PYGZus{}UTC8\PYGZus{}202312132304.h5,}
\PYG{g+go}{               data/TEST\PYGZus{}2000m\PYGZus{}4m\PYGZus{}1\PYGZus{}5000Hz\PYGZus{}200Hz\PYGZus{}UTC8\PYGZus{}202312132305.h5,}
\PYG{g+go}{               ...,}
\PYG{g+go}{               data/TEST\PYGZus{}2000m\PYGZus{}4m\PYGZus{}1\PYGZus{}5000Hz\PYGZus{}200Hz\PYGZus{}UTC8\PYGZus{}202312151831.h5]}
\PYG{g+go}{       ftime: 2023\PYGZhy{}12\PYGZhy{}13 23:04:00.558582+00:00 to 2023\PYGZhy{}12\PYGZhy{}15 18:32:00.558582+00:00}
\PYG{g+go}{     flength: 60.0}
\PYG{g+go}{         nch: 1956}
\PYG{g+go}{          nt: 12000}
\PYG{g+go}{          dx: 1.022494912147522}
\PYG{g+go}{          fs: 200.0}
\PYG{g+go}{gauge\PYGZus{}length: 4.0}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Set \sphinxcode{\sphinxupquote{meta\_from\_file='all'}} to read metadata for each file. DASPy will check if all metadata are consistent, data is continuous, and save and calculate required properties. Metadata of various types can also be specified directly. This method is very time\sphinxhyphen{}consuming for large amounts of continuous data.

\item {} 
\sphinxAtStartPar
Set \sphinxcode{\sphinxupquote{timeinfo\_format}} to get the start time from the file name, check for continuity and calculate \sphinxcode{\sphinxupquote{flength}}. \sphinxcode{\sphinxupquote{timeinfo\_format='DAS\_\%Y\sphinxhyphen{}\%m\sphinxhyphen{}\%dT\%H:\%M:\%S\%z.h5'}} indicates the time corresponding to the file name, \sphinxcode{\sphinxupquote{timeinfo\_format=(slice(33:45), '\%Y\%m\%d\%H\%M\%S')}} indicates the time corresponding to the slice of the file name.

\end{itemize}


\subsection{Data Selection}
\label{\detokenize{Handling Continuous Data:data-selection}}
\sphinxAtStartPar
Select data for a certain time period from the \sphinxcode{\sphinxupquote{Collection}} class:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{DASDateTime}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{coll}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{stime} \PYG{o}{=} \PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2023}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{)}\PYG{p}{,} \PYG{n}{etime}\PYG{o}{=}\PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2023}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{13}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{       flist: 61 files}
\PYG{g+go}{              [data/TEST\PYGZus{}2000m\PYGZus{}4m\PYGZus{}1\PYGZus{}5000Hz\PYGZus{}200Hz\PYGZus{}UTC8\PYGZus{}202312141159.h5,}
\PYG{g+go}{               data/TEST\PYGZus{}2000m\PYGZus{}4m\PYGZus{}1\PYGZus{}5000Hz\PYGZus{}200Hz\PYGZus{}UTC8\PYGZus{}202312141200.h5,}
\PYG{g+go}{               ...,}
\PYG{g+go}{               data/TEST\PYGZus{}2000m\PYGZus{}4m\PYGZus{}1\PYGZus{}5000Hz\PYGZus{}200Hz\PYGZus{}UTC8\PYGZus{}202312141259.h5]}
\PYG{g+go}{       ftime: 2023\PYGZhy{}12\PYGZhy{}13 23:04:00.558582+00:00 to 2023\PYGZhy{}12\PYGZhy{}15 18:32:00.558582+00:00}
\PYG{g+go}{     flength: 60.0}
\PYG{g+go}{         nch: 1956}
\PYG{g+go}{          nt: 12000}
\PYG{g+go}{          dx: 1.022494912147522}
\PYG{g+go}{          fs: 200.0}
\PYG{g+go}{gauge\PYGZus{}length: 4.0}
\end{sphinxVerbatim}

\sphinxAtStartPar
Setting \sphinxcode{\sphinxupquote{readsec=True}} will directly read the data of the required period as an instance of the \sphinxcode{\sphinxupquote{Section}} class and return it.


\subsection{Continuous Data Processing}
\label{\detokenize{Handling Continuous Data:continuous-data-processing}}
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{Collection.process}} method can read all files in turn as \sphinxcode{\sphinxupquote{Section}} class instances, perform a series of required processing, add a suffix and save to the target directory. This method will solve data discontinuity by caching filter states and other methods. An example of low\sphinxhyphen{}pass filtering all data and downsampling by 5 times in both time and space domains, and then integrating:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{operations} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{downsampling}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{tint}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{xint}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{lowpass\PYGZus{}filter}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+go}{                  [\PYGZsq{}time\PYGZus{}integration\PYGZsq{}, dict()]]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{coll}\PYG{o}{.}\PYG{n}{process}\PYG{p}{(}\PYG{n}{operations}\PYG{p}{,} \PYG{n}{savepath}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../processed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{suffix}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZus{}pro}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxstepscope


\section{Basic Processing}
\label{\detokenize{Basic Processing:basic-processing}}\label{\detokenize{Basic Processing::doc}}
\sphinxAtStartPar
DASPy integrates three modules: {\hyperref[\detokenize{Basic Processing:preprocessing}]{\sphinxcrossref{\DUrole{std,std-ref}{Preprocessing}}}}, {\hyperref[\detokenize{Basic Processing:filtering}]{\sphinxcrossref{\DUrole{std,std-ref}{Filtering}}}} and {\hyperref[\detokenize{Basic Processing:frequency-attribute}]{\sphinxcrossref{\DUrole{std,std-ref}{Frequency Attribute}}}} to meet basic data processing needs.


\subsection{Preprocessing}
\label{\detokenize{Basic Processing:preprocessing}}\label{\detokenize{Basic Processing:id1}}
\sphinxAtStartPar
DASPy integrates a large number of commonly used DAS preprocessing tools, including \sphinxcode{\sphinxupquote{phase2strain}} , \sphinxcode{\sphinxupquote{normalization}} , \sphinxcode{\sphinxupquote{demeaning}} , \sphinxcode{\sphinxupquote{detrending}} , \sphinxcode{\sphinxupquote{stacking}} , \sphinxcode{\sphinxupquote{cosine\_taper}} , \sphinxcode{\sphinxupquote{downsampling}} , \sphinxcode{\sphinxupquote{trimming}} , \sphinxcode{\sphinxupquote{padding}} , \sphinxcode{\sphinxupquote{time\_integration}} and \sphinxcode{\sphinxupquote{time\_differential}} 。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{detrending}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
When processing the data, the corresponding attributes will be automatically changed if necessary:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{data\PYGZus{}type}
\PYG{g+go}{\PYGZsq{}strain rate\PYGZsq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{time\PYGZus{}integration}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{data\PYGZus{}type}
\PYG{g+go}{\PYGZsq{}strain\PYGZsq{}}
\end{sphinxVerbatim}


\subsection{Filtering}
\label{\detokenize{Basic Processing:filtering}}\label{\detokenize{Basic Processing:id2}}
\sphinxAtStartPar
DASPy contains commonly used filtering methods, including \sphinxcode{\sphinxupquote{bandpass}} , \sphinxcode{\sphinxupquote{bandstop}} , \sphinxcode{\sphinxupquote{lowpass}} , \sphinxcode{\sphinxupquote{highpass}} , \sphinxcode{\sphinxupquote{envelope}} and \sphinxtitleref{lowpass\_cheby\_2`} (mainly used for low\sphinxhyphen{}pass filtering before downsampling):

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{bandpass}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{15}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Frequency Attribute}
\label{\detokenize{Basic Processing:frequency-attribute}}\label{\detokenize{Basic Processing:id3}}
\sphinxAtStartPar
The frequency domain attribute analysis supported by DASPy includes spectrum (x\sphinxhyphen{}t), spectrogram (f\sphinxhyphen{}t) and frequency\sphinxhyphen{}wavenumber spectrum (f\sphinxhyphen{}k), which are calculated using \sphinxcode{\sphinxupquote{spectrum}}, \sphinxcode{\sphinxupquote{spectrogram}} and \sphinxcode{\sphinxupquote{fk\sphinxhyphen{}transform}} respectively. method calculation. \sphinxcode{\sphinxupquote{spectrogram}} calculates the average spectrogram of all channels by default. You can use the \sphinxcode{\sphinxupquote{xmin}} and \sphinxcode{\sphinxupquote{xmax}} parameters to limit the starting and ending channels of the average spectrum:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{spec}\PYG{p}{,} \PYG{n}{f} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{spectrum}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{Zxx}\PYG{p}{,} \PYG{n}{f}\PYG{p}{,} \PYG{n}{t} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{spectrogram}\PYG{p}{(}\PYG{n}{xmin}\PYG{o}{=}\PYG{l+m+mi}{2600}\PYG{p}{,} \PYG{n}{xmax}\PYG{o}{=}\PYG{l+m+mi}{2620}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fk}\PYG{p}{,} \PYG{n}{f}\PYG{p}{,} \PYG{n}{k} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{fk\PYGZus{}transform}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
If you only need to plot these three frequency domain spectra without outputting the calculation results, you can directly use the \sphinxcode{\sphinxupquote{plot}} method. For details, see {\hyperref[\detokenize{Visualization::doc}]{\sphinxcrossref{\DUrole{doc}{Visualization}}}} .

\sphinxstepscope


\section{Visualization}
\label{\detokenize{Visualization:visualization}}\label{\detokenize{Visualization::doc}}
\sphinxAtStartPar
DASPy uses the \sphinxcode{\sphinxupquote{Section}} class method/function \sphinxcode{\sphinxupquote{plot}} to plot images.


\subsection{Call Class Method}
\label{\detokenize{Visualization:call-class-method}}
\sphinxAtStartPar
Plot and show image：

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{waveform}.png}

\sphinxAtStartPar
Adding \sphinxcode{\sphinxupquote{savefig}} to save figure as specified filename, and \sphinxcode{\sphinxupquote{dpi}} to set the resolution of the figure in dots\sphinxhyphen{}per\sphinxhyphen{}inch:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{savefig}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{waveform.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{400}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
When drawing frequency domain graphs, you can set the \sphinxcode{\sphinxupquote{kwargs\_pro}} parameter to specify how the spectrum is plotted:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{kwargs\PYGZus{}pro}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{taper}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{0.02}\PYG{p}{,} \PYG{l+m+mf}{0.05}\PYG{p}{)}\PYG{p}{,} \PYG{n}{nfft}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{1024}\PYG{p}{,} \PYG{l+m+mi}{8192}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} set the coefficient of 2D cosine taper to (0.02,0.05), output points of 2DFFT to (1024, 8192)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{fk}.png}

\sphinxAtStartPar
Plot in \sphinxcode{\sphinxupquote{Matplotlib.axes.Axes}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{waveform}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{tmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{origin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{transpose}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} set the spatial axis to the channel number, the time axis to the time after the event occurred, do not draw the x\PYGZhy{}axis label, invert the default x/y axis, and set the data range to \PYGZhy{}0.05\PYGZti{}0.05}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{spectrogram}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{tmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{origin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{kwargs\PYGZus{}pro}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{noverlap}\PYG{o}{=}\PYG{l+m+mi}{156}\PYG{p}{)}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} overlap between two windows is 156 points}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{plot_in_ax}.png}


\subsection{Call the function}
\label{\detokenize{Visualization:call-the-function}}
\sphinxAtStartPar
First calculate the spectrum, perform other calculations on the output, and then use the \sphinxcode{\sphinxupquote{daspy.basic\_tools.visualization.plot}} function to plot:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{basic\PYGZus{}tools}\PYG{n+nn}{.}\PYG{n+nn}{visualization} \PYG{k+kn}{import} \PYG{n}{plot}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{spec}\PYG{p}{,} \PYG{n}{f} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{spectrum}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{spec} \PYG{o}{=} \PYG{l+m+mi}{10} \PYG{o}{*} \PYG{n}{np}\PYG{o}{.}\PYG{n}{log10}\PYG{p}{(}\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{spec}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} convert the spectrum to units of decibels (dB), using 1 as the reference value}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plot}\PYG{p}{(}\PYG{n}{spec}\PYG{p}{,} \PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{spectrum}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{f}\PYG{o}{=}\PYG{n}{f}\PYG{p}{,} \PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} set the spatial axis to the channel number, the time axis to the time after the event occurred, and invert the default x/y axis}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{spectrum}.png}

\sphinxstepscope


\section{Channel Analysis}
\label{\detokenize{Channel Analysis:channel-analysis}}\label{\detokenize{Channel Analysis::doc}}
\sphinxAtStartPar
DASPy’s channel attribute analysis module: {\hyperref[\detokenize{Channel Analysis:location-interpolation}]{\sphinxcrossref{\DUrole{std,std-ref}{Location Interpolation}}}}, {\hyperref[\detokenize{Channel Analysis:turning-point-detection}]{\sphinxcrossref{\DUrole{std,std-ref}{Turning Point Detection}}}}, {\hyperref[\detokenize{Channel Analysis:channel-quality-checking}]{\sphinxcrossref{\DUrole{std,std-ref}{Channel Quality Checking}}}}.


\subsection{Location Interpolation}
\label{\detokenize{Channel Analysis:location-interpolation}}\label{\detokenize{Channel Analysis:id1}}
\sphinxAtStartPar
DASPy’s channel position interpolation supports the joint use of two types of data: known points containing channel numbers (i.e. longitude \& latitude \& channel number) and track points without channel numbers (ie longitude \& latitude), where the known points are necessary, and track points are optional to constrain the cable geometry. DASPy using \sphinxhref{https://en.wikipedia.org/wiki/Universal\_Transverse\_Mercator\_coordinate\_system}{Universal Transverse Mercator projection} (UTM), interpolate in the plane coordinate system and back\sphinxhyphen{}project back to the \sphinxhref{https://en.wikipedia.org/wiki/World\_Geodetic\_System}{WGS84 Coordinate System} 。

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The example data is coordinates of the North cable of the RAPID dataset, which can be read online via:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{txt\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{http://piweb.ooirsn.uw.edu/das/processed/metadata/Geometry/OOI\PYGZus{}RCA\PYGZus{}DAS\PYGZus{}channel\PYGZus{}location/north\PYGZus{}cable\PYGZus{}latlon.txt}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{track\PYGZus{}pt} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{loadtxt}\PYG{p}{(}\PYG{n}{txt\PYGZus{}url}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{p}{:}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{} read in the track points and swap the two columns (let longitude precedes latitude)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{known\PYGZus{}pt} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{o}{*}\PYG{n}{track\PYGZus{}pt}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{942}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{o}{*}\PYG{n}{track\PYGZus{}pt}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{32459}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} the 0th track point corresponds to channel 942, the last track point corresponds to channel 32459, and the channel numbers of the remaining track points are unknown}
\end{sphinxVerbatim}

\sphinxAtStartPar
Or read after downloading from \sphinxurl{http://piweb.ooirsn.uw.edu/das/processed/metadata/Geometry/OOI\_RCA\_DAS\_channel\_location/north\_cable\_latlon.txt}.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{advanced\PYGZus{}tools}\PYG{n+nn}{.}\PYG{n+nn}{channel} \PYG{k+kn}{import} \PYG{n}{location\PYGZus{}interpolation}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{interp\PYGZus{}ch} \PYG{o}{=} \PYG{n}{location\PYGZus{}interpolation}\PYG{p}{(}\PYG{n}{known\PYGZus{}pt}\PYG{p}{,} \PYG{n}{track\PYGZus{}pt}\PYG{o}{=}\PYG{n}{track\PYGZus{}pt}\PYG{p}{,} \PYG{n}{dx}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} input the track points and the known number points, the channel spacing is 2m, and get the interpolation result}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{interp\PYGZus{}ch}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} longitude, latitude, and channel number}
\PYG{g+go}{[[ \PYGZhy{}123.96715       45.2023       942.        ]}
\PYG{g+go}{ [ \PYGZhy{}123.96717541    45.20229612   943.        ]}
\PYG{g+go}{ [ \PYGZhy{}123.96720083    45.20229224   944.        ]}
\PYG{g+go}{ ...}
\PYG{g+go}{ [ \PYGZhy{}124.75097192    45.24242661 32457.        ]}
\PYG{g+go}{ [ \PYGZhy{}124.75099513    45.2424183  32458.        ]}
\PYG{g+go}{ [ \PYGZhy{}124.75101833    45.24241    32459.        ]]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt} \PYG{c+c1}{\PYGZsh{} plotting}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{interp\PYGZus{}ch}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{interp\PYGZus{}ch}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{interp\PYGZus{}ch}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jet}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{track\PYGZus{}pt}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{track\PYGZus{}pt}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{k}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{gca}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{set\PYGZus{}aspect}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{equal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Interpolated channel location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{chn_interp}.png}


\subsection{Turning Point Detection}
\label{\detokenize{Channel Analysis:turning-point-detection}}\label{\detokenize{Channel Analysis:id2}}
\sphinxAtStartPar
DASPy detect turning points detection through two methods: calculating the corner of the fiber through the channel coordinates, or finding channels with low adjacent channel cross\sphinxhyphen{}correlation values in the waveform record.

\sphinxAtStartPar
Calculated by channel latitude and longitude:

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The example data is the DAS channel coordinates of the Brady geothermal field, which can be read online via:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{csv\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://raw.githubusercontent.com/HMZ\PYGZhy{}03/DASPy\PYGZhy{}data/main/Brady\PYGZus{}DAS\PYGZus{}Coordinates.csv}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{geometry} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{loadtxt}\PYG{p}{(}\PYG{n}{csv\PYGZus{}url}\PYG{p}{,} \PYG{n}{delimiter}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{skiprows}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{usecols}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{geometry} \PYG{o}{=} \PYG{n}{geometry}\PYG{p}{[}\PYG{n}{geometry}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{} exclude empty records}
\end{sphinxVerbatim}

\sphinxAtStartPar
or read after downloading from \sphinxurl{https://raw.githubusercontent.com/HMZ-03/DASPy-data/main/Brady\_DAS\_Coordinates.csv}.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{advanced\PYGZus{}tools}\PYG{n+nn}{.}\PYG{n+nn}{channel} \PYG{k+kn}{import} \PYG{n}{turning\PYGZus{}points}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{turning\PYGZus{}h}\PYG{p}{,} \PYG{n}{turning\PYGZus{}v} \PYG{o}{=} \PYG{n}{turning\PYGZus{}points}\PYG{p}{(}\PYG{n}{geometry}\PYG{p}{,} \PYG{n}{depth\PYGZus{}info}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} the data contains depth information, detect turning points both horizontally and vertically}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt} \PYG{c+c1}{\PYGZsh{} plotting}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{geometry}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{geometry}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{y}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{geometry}\PYG{p}{[}\PYG{n}{turning\PYGZus{}v}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{geometry}\PYG{p}{[}\PYG{n}{turning\PYGZus{}v}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vertical}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{geometry}\PYG{p}{[}\PYG{n}{turning\PYGZus{}h}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{geometry}\PYG{p}{[}\PYG{n}{turning\PYGZus{}h}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{horizontal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{gca}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{set\PYGZus{}aspect}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{equal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Turning points}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{turning_points}.png}


\subsection{Channel Quality Checking}
\label{\detokenize{Channel Analysis:channel-quality-checking}}\label{\detokenize{Channel Analysis:id3}}
\sphinxAtStartPar
Sometimes there are areas with poor coupling conditions along optical fiber, such as reserved loops in communication optical cables, resulting in “bad channels”. These “bad channels” usually correspond to areas on the waveform with abnormally low or abnormally high amplitudes. When the coupling conditions are unknown, DASPy can use a DAS record to check the channel quality and determine the so\sphinxhyphen{}called “bad channels”:

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The sample data is a 15\sphinxhyphen{}second traffic signal recorded by Ridgecrest DAS, which can be downloaded from \sphinxurl{https://data.caltech.edu/records/31emd-wmv98/files/Traffic\_noise\_figure\_4.mat?download=1} and read via the following method:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{io} \PYG{k}{as} \PYG{n+nn}{scio}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data} \PYG{o}{=} \PYG{n}{scio}\PYG{o}{.}\PYG{n}{loadmat}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Traffic\PYGZus{}noise\PYGZus{}figure\PYGZus{}4.mat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Traffic\PYGZus{}noise\PYGZus{}figure\PYGZus{}4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{T}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{Section}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{250}\PYG{p}{)}
\end{sphinxVerbatim}
\end{sphinxadmonition}

\sphinxAtStartPar
Call a function to check good and bad channels:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{advanced\PYGZus{}tools}\PYG{n+nn}{.}\PYG{n+nn}{channel} \PYG{k+kn}{import} \PYG{n}{channel\PYGZus{}checking}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{good\PYGZus{}chn}\PYG{p}{,} \PYG{n}{bad\PYGZus{}chn} \PYG{o}{=} \PYG{n}{channel\PYGZus{}checking}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{bad\PYGZus{}chn}\PYG{p}{)}
\PYG{g+go}{[  11   12   13   14   18   19   20   21   22   23   81   82   83   84}
\PYG{g+go}{85   86   87   88   89  142  143  144  145  146  255  256  257  258}
\PYG{g+go}{259  260  261  262  263  264  265  266  267  268  269  270  454  455}
\PYG{g+go}{456  457  458  459  460  461  462  463  464  465  466  467  468  469}
\PYG{g+go}{470  471  472  664  665  666  667  668  669  842  843  844  845  846}
\PYG{g+go}{847  848  849  850  851  852  853  854  855  856  857  858  859  860}
\PYG{g+go}{861  862  863  864  865  866  867  868  869  870  871 1059 1060 1061}
\PYG{g+go}{1062 1063 1064 1065 1066]}
\end{sphinxVerbatim}

\sphinxAtStartPar
Directly remove bad channels in the \sphinxcode{\sphinxupquote{daspy.Section}} instance:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{channel\PYGZus{}checking}\PYG{p}{(}\PYG{n}{use}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxstepscope


\section{Denoising}
\label{\detokenize{Denoising:denoising}}\label{\detokenize{Denoising::doc}}
\sphinxAtStartPar
The noise in DAS signals mainly includes spike noise, common mode noise, stochastic noise and coherent noise.
DASPy’s data denoising module provides three functions: {\hyperref[\detokenize{Denoising:spike-removal}]{\sphinxcrossref{\DUrole{std,std-ref}{Spike Removal}}}}, {\hyperref[\detokenize{Denoising:common-mode-noise-removal}]{\sphinxcrossref{\DUrole{std,std-ref}{Common Mode Noise Removal}}}} and {\hyperref[\detokenize{Denoising:stochastic-noise-removal}]{\sphinxcrossref{\DUrole{std,std-ref}{Stochastic Noise Removal}}}}. Coherent noise can be removed by methods provided in {\hyperref[\detokenize{Wavefield Decomposition::doc}]{\sphinxcrossref{\DUrole{doc}{Wavefield Decomposition}}}}.


\subsection{Spike Removal}
\label{\detokenize{Denoising:spike-removal}}\label{\detokenize{Denoising:id1}}
\sphinxAtStartPar
Spikes are unusually large amplitudes and could be caused by laser frequency drift or laser noise. The spike removal function first applies the across\sphinxhyphen{}channel median filter and then the across\sphinxhyphen{}time median filter to generate a median map from the absolute amplitudes. Points with amplitudes exceeding a predefined threshold of the median map are identified as spikes. All spikes are subsequently substituted with interpolated values from adjacent channels.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The example data is the seismic signal recorded by Stanford DAS\sphinxhyphen{}1, which can be downloaded from \sphinxurl{https://raw.githubusercontent.com/HMZ-03/DASPy-data/main/Stanford1\_20180104\_113058.566+0000.sgy} , read and preprocess via:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}\PYG{p}{,} \PYG{n}{DASDateTime}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Stanford1\PYGZus{}20180104\PYGZus{}113058.566+0000.sgy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ch2}\PYG{o}{=}\PYG{l+m+mi}{320}\PYG{p}{)}
\PYG{g+go}{UserWarning: This data format segy doesn\PYGZsq{}t include channel interval.}
\PYG{g+go}{Please set Section.dx manually.}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{dx} \PYG{o}{=} \PYG{l+m+mi}{8}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{start\PYGZus{}time} \PYG{o}{=} \PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2018}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{58}\PYG{p}{,} \PYG{l+m+mi}{566000}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{origin\PYGZus{}time} \PYG{o}{=} \PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2018}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{34}\PYG{p}{,} \PYG{l+m+mi}{44}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{bandpass}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{trimming}\PYG{p}{(}\PYG{n}{tmin}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{tmax}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{12}\PYG{p}{)}
\end{sphinxVerbatim}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{spike_removal0}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{spike\PYGZus{}removal}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{spike_removal1}.png}


\subsection{Common Mode Noise Removal}
\label{\detokenize{Denoising:common-mode-noise-removal}}\label{\detokenize{Denoising:id2}}
\sphinxAtStartPar
Common\sphinxhyphen{}mode noise, also known as in\sphinxhyphen{}phase noise is generated by vibrations of the optoelectronic system and arises on all channels simultaneously. DASPy employs spatial median or mean of waveforms to obtain common mode noise. Subsequently, we compute the correlation coefficient with the channel record and the common\sphinxhyphen{}mode noise, multiply the common\sphinxhyphen{}mode noise by the coefficient, and subtract it from the channel record.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The example data is the waveforms recorded by channels away from the coast of the RAPID dataset, which can be downloaded from \sphinxurl{http://piweb.ooirsn.uw.edu/das/data/Optasense/NorthCable/TransmitFiber/North-C1-LR-P1kHz-GL50m-Sp2m-FS200Hz\_2021-11-03T15\_06\_51-0700/North-C1-LR-P1kHz-GL50m-Sp2m-FS200Hz\_2021-11-04T015902Z.h5} , read and preprocess via:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{North\PYGZhy{}C1\PYGZhy{}LR\PYGZhy{}P1kHz\PYGZhy{}GL50m\PYGZhy{}Sp2m\PYGZhy{}FS200Hz\PYGZus{}2021\PYGZhy{}11\PYGZhy{}04T015902Z.h5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{trimming}\PYG{p}{(}\PYG{n}{mode}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{xmin}\PYG{o}{=}\PYG{l+m+mi}{18000}\PYG{p}{,} \PYG{n}{xmax}\PYG{o}{=}\PYG{l+m+mi}{30000}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{scale} \PYG{o}{=} \PYG{l+m+mi}{2} \PYG{o}{*} \PYG{n}{np}\PYG{o}{.}\PYG{n}{pi} \PYG{o}{/} \PYG{l+m+mi}{2} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{16} \PYG{c+c1}{\PYGZsh{} data scaling factor, see sec.headers[\PYGZsq{}Acquisition\PYGZsq{}][\PYGZsq{}Raw[0]\PYGZsq{}][\PYGZsq{}attrs\PYGZsq{}][\PYGZsq{}RawDataUnit\PYGZsq{}]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{phase2strain}\PYG{p}{(}\PYG{l+m+mf}{1550.12} \PYG{o}{*} \PYG{l+m+mf}{1e\PYGZhy{}9}\PYG{p}{,} \PYG{l+m+mf}{0.78}\PYG{p}{,} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{headers}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Acquisition}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Custom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{attrs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Fibre Refractive Index}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} convert optical phase shift to strain}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{bandpass}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{27}\PYG{p}{,} \PYG{n}{detrend}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{taper}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{trimming}\PYG{p}{(}\PYG{n}{tmin}\PYG{o}{=}\PYG{n}{sec}\PYG{o}{.}\PYG{n}{start\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{tmax}\PYG{o}{=}\PYG{n}{sec}\PYG{o}{.}\PYG{n}{start\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{30}\PYG{p}{)}
\end{sphinxVerbatim}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{common_mode_noise_removal0}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{common\PYGZus{}mode\PYGZus{}noise\PYGZus{}removal}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{common_mode_noise_removal1}.png}


\subsection{Stochastic Noise Removal}
\label{\detokenize{Denoising:stochastic-noise-removal}}\label{\detokenize{Denoising:id3}}
\sphinxAtStartPar
The inherent stochastic noise in DAS data is primarily caused by instrumental deficiencies such as sampling error and phase noise. DASPy remove stochastic noise by curvelet transform.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Consistent with the example data used by {\hyperref[\detokenize{Denoising:spike-removal}]{\sphinxcrossref{\DUrole{std,std-ref}{Spike Removal}}}} . The waveform with spikes removed is used here. Read and preprocess via:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}\PYG{p}{,} \PYG{n}{DASDateTime}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Stanford1\PYGZus{}20180104\PYGZus{}113058.566+0000.sgy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ch2}\PYG{o}{=}\PYG{l+m+mi}{320}\PYG{p}{)}
\PYG{g+go}{UserWarning: This data format segy doesn\PYGZsq{}t include channel interval.}
\PYG{g+go}{Please set Section.dx manually.}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{dx} \PYG{o}{=} \PYG{l+m+mi}{8}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{start\PYGZus{}time} \PYG{o}{=} \PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2018}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{58}\PYG{p}{,} \PYG{l+m+mi}{566000}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{bandpass}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{origin\PYGZus{}time} \PYG{o}{=} \PYG{n}{DASDateTime}\PYG{p}{(}\PYG{l+m+mi}{2018}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{34}\PYG{p}{,} \PYG{l+m+mi}{44}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{trimming}\PYG{p}{(}\PYG{n}{tmin}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{tmax}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{12}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{spike\PYGZus{}removal}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\end{sphinxadmonition}

\sphinxAtStartPar
Use a noise record as the noise baseline and remove the noise with a soft threshold (default) in the curvelet domain:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{trimming}\PYG{p}{(}\PYG{n}{tmin}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{tmax}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{+}\PYG{l+m+mi}{12}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} earthquake records}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}ns} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{trimming}\PYG{p}{(}\PYG{n}{tmin}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{tmax}\PYG{o}{=}\PYG{n}{origin\PYGZus{}time}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} noise records}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq\PYGZus{}soft} \PYG{o}{=} \PYG{n}{sec\PYGZus{}eq}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{curvelet\PYGZus{}denoising}\PYG{p}{(}\PYG{n}{noise}\PYG{o}{=}\PYG{n}{sec\PYGZus{}ns}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Also using the reference noise record, removing the noise with a hard threshold in the curvelet domain can keep the absolute amplitude of the waveform unchanged and cause little distortion:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq\PYGZus{}hard} \PYG{o}{=} \PYG{n}{sec\PYGZus{}eq}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{curvelet\PYGZus{}denoising}\PYG{p}{(}\PYG{n}{noise}\PYG{o}{=}\PYG{n}{sec\PYGZus{}ns}\PYG{p}{,} \PYG{n}{soft\PYGZus{}thresh}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
When there is no reference noise record available, the function will calculate the inflection points of the curvelet coefficients to determine the noise threshold. It is recommended to set \sphinxcode{\sphinxupquote{pad=0}} and adjust the \sphinxcode{\sphinxupquote{knee\_fac}} parameter to reduce artificial artifacts (this method is not recommended) :

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq\PYGZus{}knee} \PYG{o}{=} \PYG{n}{sec\PYGZus{}eq}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{curvelet\PYGZus{}denoising}\PYG{p}{(}\PYG{n}{pad}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{knee\PYGZus{}fac}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Plot the original waveform and the above three denoising effects:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq\PYGZus{}soft}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{ylabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{soft thresh}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq\PYGZus{}hard}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{hard thresh}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq\PYGZus{}knee}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xmode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{channel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{ylabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{without reference noise}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{curvelet_denoising}.png}

\sphinxstepscope


\section{Wavefield Decomposition}
\label{\detokenize{Wavefield Decomposition:wavefield-decomposition}}\label{\detokenize{Wavefield Decomposition::doc}}
\sphinxAtStartPar
The wavefield recorded by DAS usually has complex components. We often need to separate the wavefield according to apparent velocity to extract some of the required signals, such as separating seismic signals and traffic signals, separating direct wave and scattered wave, etc. Due to the good equidistant characteristics of DAS, the wavefield recorded by DAS can be quickly and easily decomposed using image processing technology. DASPy uses two\sphinxhyphen{}dimensional fast Fourier transform (called FK transform in seismic data processing, see {\hyperref[\detokenize{Wavefield Decomposition:fk-filtering}]{\sphinxcrossref{\DUrole{std,std-ref}{FK Filtering}}}} ) and fast discrete curvelet transform technology (see {\hyperref[\detokenize{Wavefield Decomposition:curvelet-windowing-technology}]{\sphinxcrossref{\DUrole{std,std-ref}{Curvelet Windowing Technology}}}} ) to decompose the DAS wavefield.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The example data for this Section is the 30\sphinxhyphen{}second M1.79 earthquake signal recorded by Ridgecrest DAS, which can be downloaded from \sphinxurl{https://data.caltech.edu/records/31emd-wmv98/files/EQ\_raw\_figure\_1.mat?download=1}, read and preprocess via:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{io} \PYG{k}{as} \PYG{n+nn}{scio}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{Section}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data} \PYG{o}{=} \PYG{n}{scio}\PYG{o}{.}\PYG{n}{loadmat}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{EQ\PYGZus{}raw\PYGZus{}figure\PYGZus{}1.mat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{EQ\PYGZus{}raw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{T} \PYG{c+c1}{\PYGZsh{} read the data}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{Section}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{250}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} build Section instance}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{spike\PYGZus{}removal}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} remove spikes}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{channel\PYGZus{}checking}\PYG{p}{(}\PYG{n}{use}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} remove bad channels}
\end{sphinxVerbatim}
\end{sphinxadmonition}


\subsection{FK Filtering}
\label{\detokenize{Wavefield Decomposition:fk-filtering}}\label{\detokenize{Wavefield Decomposition:id1}}
\sphinxAtStartPar
The FK filtering method uses two\sphinxhyphen{}dimensional fast Fourier transform to convert the data into the frequency\sphinxhyphen{}wavenumber (FK) domain, multiplies the FK domain by the filter window and then inversely transforms it back to the time\sphinxhyphen{}distance domain. If the apparent wave speed of traffic signals in the area is less than 1000m/s and the apparent wave speed of seismic waves is greater than 1000m/s, you can use \sphinxcode{\sphinxupquote{vmin=(800, 1200)}} to filter out the traffic signals. The first output is seismic waves, and the second outputs are traffic signals. \sphinxcode{\sphinxupquote{800}} and \sphinxcode{\sphinxupquote{1200}} are the taper boundaries:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq}\PYG{p}{,} \PYG{n}{sec\PYGZus{}tf} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{fk\PYGZus{}filter}\PYG{p}{(}\PYG{n}{vmin}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{)}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{decompose}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
FK filtering often causes various artifacts, particularly edge artifacts caused by discontinuities at the waveform’s edge, and star\sphinxhyphen{}like artifacts originating from discontinuities in the FK domain. To minimize these artifacts, DASPy employs cosine tapers (e.g. Tukey window) on the waveforms, as well as the filtering window in the FK domain.

\sphinxAtStartPar
Plot the waveforms and FK spectra of the original waveform, the separated direct wave and the scattered wave:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}dr}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}sc}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy}\PYG{n+nn}{.}\PYG{n+nn}{basic\PYGZus{}tools}\PYG{n+nn}{.}\PYG{n+nn}{visualization} \PYG{k+kn}{import} \PYG{n}{plot}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax} \PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{2e5}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plot}\PYG{p}{(}\PYG{n}{fk}\PYG{p}{,} \PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{f}\PYG{o}{=}\PYG{n}{f}\PYG{p}{,} \PYG{n}{k}\PYG{o}{=}\PYG{n}{k}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,}\PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plot}\PYG{p}{(}\PYG{n}{fk}\PYG{o}{*}\PYG{n}{mask}\PYG{p}{,} \PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{f}\PYG{o}{=}\PYG{n}{f}\PYG{p}{,} \PYG{n}{k}\PYG{o}{=}\PYG{n}{k}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plot}\PYG{p}{(}\PYG{n}{fk}\PYG{o}{*}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{n}{mask}\PYG{p}{)}\PYG{p}{,} \PYG{n}{obj}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{f}\PYG{o}{=}\PYG{n}{f}\PYG{p}{,} \PYG{n}{k}\PYG{o}{=}\PYG{n}{k}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{ylim}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{30}\PYG{p}{]}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{fk_filter}.png}


\subsection{Curvelet Windowing Technology}
\label{\detokenize{Wavefield Decomposition:curvelet-windowing-technology}}\label{\detokenize{Wavefield Decomposition:id2}}
\sphinxAtStartPar
The curvelet transform can similarly achieve the effect of decomposing the wave field at the apparent wave velocity.

\sphinxAtStartPar
Separate seismic waves and traffic signals at a speed of 1000m/s:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq}\PYG{p}{,} \PYG{n}{sec\PYGZus{}tf} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{curvelet\PYGZus{}windowing}\PYG{p}{(}\PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{decompose}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Plot the original waveform, the separated direct wave, and the scattered wave:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{row}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{row}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plot\PYGZus{}kwargs} \PYG{o}{=} \PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Raw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{plot\PYGZus{}kwargs}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}eq}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Earthquake}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ylabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{plot\PYGZus{}kwargs}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}tf}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Traffic}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ylabel}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{plot\PYGZus{}kwargs}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{curvelet_windowing}.png}

\sphinxstepscope


\section{Strain\sphinxhyphen{}velocity Conversion}
\label{\detokenize{Strain-velocity Conversion:strain-velocity-conversion}}\label{\detokenize{Strain-velocity Conversion::doc}}
\sphinxAtStartPar
DAS measures strain or strain rate, whereas traditional seismological studies typically use displacement, velocity or acceleration. Strain can be converted to particle velocity by multiplying the apparent phase velocity. Based on this principle, DASPy integrates three methods for converting strain/strain rate into velocity/acceleration (hereinafter collectively referred to as strain\sphinxhyphen{}velocity conversion): {\hyperref[\detokenize{Strain-velocity Conversion:fk-rescaling-method}]{\sphinxcrossref{\DUrole{std,std-ref}{FK Rescaling Method}}}}, {\hyperref[\detokenize{Strain-velocity Conversion:curvelet-transform-method}]{\sphinxcrossref{\DUrole{std,std-ref}{Curvelet Transform Method}}}} and {\hyperref[\detokenize{Strain-velocity Conversion:time-domain-slowness-detection-method}]{\sphinxcrossref{\DUrole{std,std-ref}{Time\sphinxhyphen{}Domain Slowness Detection Method}}}}.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The example data for this section is the M4.3 earthquake recorded by a section of DAS in the Brady geothermal experimental field, which can be downloaded from \sphinxurl{https://raw.githubusercontent.com/HMZ-03/DASPy-data/main/Brady\_DAS\_M4.3\_2688\_2826.pkl}; The data recorded at the same time by No.165 node seismometer for comparison can be downloaded from \sphinxurl{https://raw.githubusercontent.com/HMZ-03/DASPy-data/main/Brady\_node\_M4.3\_165.sac}. The distance between DAS channel 2781 and the seismometer at this node is 2.6 meters. The preprocessing that has been done on the DAS data includes: intercepting a certain linear segment (channels 2688 to 2826), removing the timing error (1.048 seconds), integrating the strain rate into strain, downsampling from 1000Hz to 500Hz, and bandpass filtering to 1\textasciitilde{}5Hz, trimmed from 19.99 seconds to 70.01 seconds after the earthquake origin (allowing a time difference of ±0.01 seconds when calculating cross\sphinxhyphen{}correlation with node seismometer data). The preprocessing that has been done on the node seismometer includes: rotating to the DAS axial component, filtering to 1\textasciitilde{}5Hz, and trimmed 20 seconds to 70 seconds after the earthquake occurs. Read via (requires \sphinxhref{https://docs.obspy.org/}{ObsPy} installed):

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{obspy}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{daspy} \PYG{k+kn}{import} \PYG{n}{read}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{st} \PYG{o}{=} \PYG{n}{obspy}\PYG{o}{.}\PYG{n}{read}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Brady\PYGZus{}node\PYGZus{}M4.3\PYGZus{}165.sac}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec} \PYG{o}{=} \PYG{n}{read}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Brady\PYGZus{}DAS\PYGZus{}M4.3\PYGZus{}2688\PYGZus{}2826.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{sphinxadmonition}


\subsection{FK Rescaling Method}
\label{\detokenize{Strain-velocity Conversion:fk-rescaling-method}}\label{\detokenize{Strain-velocity Conversion:id1}}
\sphinxAtStartPar
The FK rescaling method achieves strain\sphinxhyphen{}to\sphinxhyphen{}velocity conversion by multiplying each point in the FK domain by its corresponding apparent velocity (slope in the FK domain).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}fk} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fk\PYGZus{}rescaling}\PYG{p}{(}\PYG{n}{fmax}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Curvelet Transform Method}
\label{\detokenize{Strain-velocity Conversion:curvelet-transform-method}}\label{\detokenize{Strain-velocity Conversion:id2}}
\sphinxAtStartPar
The basis function of the curvelet transform appears as a wedge with a certain velocity range in the FK domain. The curvelet transform method multiplies each curvelet coefficient by the median velocity of its basis function to achieve strain\sphinxhyphen{}velocity conversion.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}cv} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{curvelet\PYGZus{}conversion}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Time\sphinxhyphen{}Domain Slowness Detection Method}
\label{\detokenize{Strain-velocity Conversion:time-domain-slowness-detection-method}}\label{\detokenize{Strain-velocity Conversion:id3}}
\sphinxAtStartPar
The time domain slowness determination method obtains the apparent speed at each time step by searching for the maximum semblance.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sec\PYGZus{}ts} \PYG{o}{=} \PYG{n}{sec}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{slant\PYGZus{}stacking}\PYG{p}{(}\PYG{n}{L}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{frqlow}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{frqhigh}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{channel}\PYG{o}{=}\PYG{l+m+mi}{2781}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} only convert channel 2781 and save into the Section instance for efficiency}
\end{sphinxVerbatim}


\subsection{Comparison of Three Methods}
\label{\detokenize{Strain-velocity Conversion:comparison-of-three-methods}}\begin{quote}

\sphinxAtStartPar
Define a function for calculating the cross\sphinxhyphen{}correlation coefficient and shift:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k}{def} \PYG{n+nf}{X\PYGZus{}corr}\PYG{p}{(}\PYG{n}{a}\PYG{p}{,} \PYG{n}{b}\PYG{p}{)}\PYG{p}{:}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{n}{M}\PYG{p}{,} \PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{a}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{b}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{n}{b} \PYG{o}{=} \PYG{p}{(}\PYG{n}{b} \PYG{o}{\PYGZhy{}} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{b}\PYG{p}{)}\PYG{p}{)} \PYG{o}{/} \PYG{n}{np}\PYG{o}{.}\PYG{n}{std}\PYG{p}{(}\PYG{n}{b}\PYG{p}{)} \PYG{o}{/} \PYG{n}{N}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{n}{cc} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{n}{M}\PYG{o}{\PYGZhy{}}\PYG{n}{N}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{M}\PYG{o}{\PYGZhy{}}\PYG{n}{N}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{a\PYGZus{}p} \PYG{o}{=} \PYG{n}{a}\PYG{p}{[}\PYG{n}{i}\PYG{p}{:}\PYG{n}{i}\PYG{o}{+}\PYG{n}{N}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{a\PYGZus{}p} \PYG{o}{=} \PYG{p}{(}\PYG{n}{a\PYGZus{}p} \PYG{o}{\PYGZhy{}} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{a\PYGZus{}p}\PYG{p}{)}\PYG{p}{)} \PYG{o}{/} \PYG{n}{np}\PYG{o}{.}\PYG{n}{std}\PYG{p}{(}\PYG{n}{a\PYGZus{}p}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }        \PYG{n}{cc}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{correlate}\PYG{p}{(}\PYG{n}{a\PYGZus{}p}\PYG{p}{,} \PYG{n}{b}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{valid}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{cc}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{max}\PYG{p}{(}\PYG{n}{cc}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Plot the strain\sphinxhyphen{}velocity conversion results for the three methods:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{node\PYGZus{}data} \PYG{o}{=} \PYG{n}{st}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{data}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nt} \PYG{o}{=} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{node\PYGZus{}data}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt1}\PYG{p}{,} \PYG{n}{cc1} \PYG{o}{=} \PYG{n}{X\PYGZus{}corr}\PYG{p}{(}\PYG{n}{sec\PYGZus{}fk}\PYG{o}{.}\PYG{n}{channel\PYGZus{}data}\PYG{p}{(}\PYG{l+m+mi}{2781}\PYG{p}{)}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fk\PYGZus{}data} \PYG{o}{=} \PYG{n}{sec\PYGZus{}fk}\PYG{o}{.}\PYG{n}{channel\PYGZus{}data}\PYG{p}{(}\PYG{l+m+mi}{2781}\PYG{p}{)}\PYG{p}{[}\PYG{n}{dt1}\PYG{p}{:}\PYG{n}{dt1}\PYG{o}{+}\PYG{n}{nt}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt2}\PYG{p}{,} \PYG{n}{cc2} \PYG{o}{=} \PYG{n}{X\PYGZus{}corr}\PYG{p}{(}\PYG{n}{sec\PYGZus{}cv}\PYG{o}{.}\PYG{n}{channel\PYGZus{}data}\PYG{p}{(}\PYG{l+m+mi}{2781}\PYG{p}{)}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{cv\PYGZus{}data} \PYG{o}{=} \PYG{n}{sec\PYGZus{}cv}\PYG{o}{.}\PYG{n}{channel\PYGZus{}data}\PYG{p}{(}\PYG{l+m+mi}{2781}\PYG{p}{)}\PYG{p}{[}\PYG{n}{dt2}\PYG{p}{:}\PYG{n}{dt2}\PYG{o}{+}\PYG{n}{nt}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt3}\PYG{p}{,} \PYG{n}{cc3} \PYG{o}{=} \PYG{n}{X\PYGZus{}corr}\PYG{p}{(}\PYG{n}{sec\PYGZus{}ts}\PYG{o}{.}\PYG{n}{channel\PYGZus{}data}\PYG{p}{(}\PYG{l+m+mi}{2781}\PYG{p}{)}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ts\PYGZus{}data} \PYG{o}{=} \PYG{n}{sec\PYGZus{}ts}\PYG{o}{.}\PYG{n}{channel\PYGZus{}data}\PYG{p}{(}\PYG{l+m+mi}{2781}\PYG{p}{)}\PYG{p}{[}\PYG{n}{dt3}\PYG{p}{:}\PYG{n}{dt3}\PYG{o}{+}\PYG{n}{nt}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{250}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{t} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{nt}\PYG{p}{)}\PYG{o}{/}\PYG{n}{sec}\PYG{o}{.}\PYG{n}{fs} \PYG{o}{+} \PYG{l+m+mi}{20}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{c} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}999999}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}20639B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ED553B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}F6D55C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{M4.3 Earthquake}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{fk\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{cv\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{40}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{ts\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mi}{22}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{node data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mi}{22}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fk\PYGZus{}res: cc=}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{cc1}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mi}{22}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{35}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{curvelet: cc=}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{cc2}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mi}{22}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{55}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{slowness: cc=}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{cc3}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{70}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{80}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticks}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Velocity (nm/s)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{P\PYGZhy{}wave}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{o}{+}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{fk\PYGZus{}data}\PYG{o}{+}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{cv\PYGZus{}data}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{ts\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{27}\PYG{p}{,} \PYG{l+m+mi}{32}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticks}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Velocity (nm/s)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{S\PYGZhy{}wave}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{o}{+}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{node\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{fk\PYGZus{}data}\PYG{o}{+}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{cv\PYGZus{}data}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{t}\PYG{p}{,} \PYG{n}{ts\PYGZus{}data}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{c}\PYG{o}{=}\PYG{n}{c}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{46}\PYG{p}{,} \PYG{l+m+mi}{56}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{40}\PYG{p}{,} \PYG{l+m+mi}{40}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticks}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{40}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Velocity (nm/s)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{strain2vel}.png}

\sphinxAtStartPar
If you have any questions, please contact \sphinxurl{mailto:hmz2018@mail.ustc.edu.cn}.



\renewcommand{\indexname}{Index}
\printindex
\end{document}